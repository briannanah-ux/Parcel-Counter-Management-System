// Arduino code omitted for brevity (full version in conversation)